
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Liquid water path (LWP) from different sources &#8212; pyac3airborne-book</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">pyac3airborne-book</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../campaigns.html">
   Campaigns
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../datasets.html">
   Datasets
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="mirac_a.html">
     MiRAC-A
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mirac_p.html">
     MiRAC-P
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hatpro.html">
     HATPRO
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="amali_cloud_top_height.html">
     AMALi cloud top height
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../datasets/kt19.html">
     KT-19
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../datasets/dropsondes.html">
     Dropsondes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../datasets/gps_ins.html">
     GPS/INS
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../guidelines.html">
   yaml file design
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../yamls/flights.html">
     flight-phase-separation
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../code.html">
   Code
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="flight_tracks.html">
     Flight tracks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="reading_the_flight_phase_files.html">
     Querying the
     <em>
      flight phase files
     </em>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="land_ocean.html">
     Check if the aircraft is over land or ocean
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../references.html">
   References
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/examples/lwp_project.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/examples/lwp_project.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Liquid water path (LWP) from different sources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overview-of-research-flight-rf07-on-07-09-2020">
     Overview of research flight RF07 on 07.09.2020
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#liquid-water-path-retrieval-from-brightness-temperature-observations">
   Liquid water path retrieval from brightness temperature observations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collcection-of-methods-for-the-project-work">
     Collcection of methods for the project work
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#open-pamtra-simulations">
     Open PAMTRA simulations
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#develop-retrieval-coefficients-for-liquid-water-path">
     Develop retrieval coefficients for liquid water path
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-in-airborne-data">
     Read in  airborne data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cut-out-corners">
       Cut out corners
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#get-airborne-brightness-temperature-measurements">
       Get airborne brightness temperature measurements
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#datasets-and-todos">
     Datasets and ToDos
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="liquid-water-path-lwp-from-different-sources">
<h1>Liquid water path (LWP) from different sources<a class="headerlink" href="#liquid-water-path-lwp-from-different-sources" title="Permalink to this headline">¶</a></h1>
<p>Analysis of LWP derived from 89 GHz airborne measurements with the Microwave Radar and radiometer (<span class="xref myst">MiRAC; Mech et al. 2019</span>) onboard Polar 5, ERA5 reanalysis, ICON models simulations, and the satellite products from MODIS and AMSR2 of the the 7th September 2020, a day of the MOSAiC-ACA airborne campaign.</p>
<p><strong>QUESTION</strong>:</p>
<ul class="simple">
<li><p>How much LWP did we have?</p></li>
<li><p>What is the variability of LWP along the flightrack?</p></li>
<li><p>How does the airborne LWP compare to satellite (MODIS, AMSR), reanalysis and model (ERA5, ICON) data?</p></li>
</ul>
<p><strong>Literature</strong></p>
<p>Some suggestions to start with are:</p>
<ul class="simple">
<li><p>Mech, M., L.-L. Kliesch, A. Anhäuser, T. Rose, P. Kollias and S. Crewell, 2019: Microwave Radar/radiometer for Arctic Clouds MiRAC: first insights from the ACLOUD campaign, Atmospheric Measurement Techniques, 12, 5019–5037, <span class="xref myst">https://doi.org/10.5194/amt-12-5019-2019</span></p></li>
<li><p>Wendisch, M., et al., 2019: The Arctic Cloud Puzzle: Using ACLOUD/PASCAL Multi-Platform Observations to Unravel the Role of Clouds and Aerosol Particles in Arctic Amplification, Bulletin of the American Meteorological Society, 100 (5), 841-871, <span class="xref myst">https://doi.org/10.1175/BAMS-D-18-0072.1</span></p></li>
<li><p>Ruiz-Donoso, E., Ehrlich, A., Schäfer, M., Jäkel, E., Schemann, V., Crewell, S., Mech, M., Kulla, B. S., Kliesch, L.-L., Neuber, R., and Wendisch, M., 2020: Small-scale structure of thermodynamic phase in Arctic mixed-phase clouds observed by airborne remote sensing during a cold air outbreak and a warm air advection event, Atmospheric Chemistry and Physics, 20, 5487–5511, <span class="xref myst">https://doi.org/10.5194/acp-20-5487-2020</span>.</p></li>
<li><p>Elsaesser, G. S., O’Dell, C. W., Lebsock, M. D., Bennartz, R., Greenwald, T. J., and Wentz, F. J., 2017: The Multisensor Advanced Climatology ofLiquid Water Path (MAC-LWP), Journal of Climate, 30, 10 193–10 210, <span class="xref myst">https://doi.org/10.1175/JCLI-D-16-0902.1</span>.</p></li>
<li><p>Jacob, M., Ament, F., Gutleben, M., Konow, H., Mech, M., Wirth, M., and Crewell, S., 2019: Investigating the liquid water path over the tropicalAtlantic with synergistic airborne measurements, Atmospheric Measurement Techniques, 12, 3237–3254, <span class="xref myst">https://doi.org/10.5194/amt-12-6103237-2019</span>.</p></li>
</ul>
<div class="section" id="overview-of-research-flight-rf07-on-07-09-2020">
<h2>Overview of research flight RF07 on 07.09.2020<a class="headerlink" href="#overview-of-research-flight-rf07-on-07-09-2020" title="Permalink to this headline">¶</a></h2>
<p>In August/September 2020, the MOSAiC-ACA campaign took place in the Fam strait and around Svalbard with base in Longyearbyen. The <span class="xref myst">flight reports</span> give a more detauled overview on the performed flights and conditions during the campaign. A more technical overview is on the <span class="xref myst">wiki page</span>.</p>
<p>Focus of the RF07 on 07.09.2020, the flight which is discussed in the project, was the remote sensing of the different cloud regimes North West of Svalbard.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pylab</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;map_MOSAiC-ACA_20200907.png&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">imgplot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Populating the interactive namespace from numpy and matplotlib
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">277</span><span class="n">a16903eaa</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;pylab&#39;</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="kn">as</span> <span class="nn">mpimg</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;map_MOSAiC-ACA_20200907.png&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">imgplot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.8/dist-packages/matplotlib/image.py</span> in <span class="ni">imread</span><span class="nt">(fname, format)</span>
<span class="g g-Whitespace">   </span><span class="mi">1494</span>                     <span class="n">response</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="g g-Whitespace">   </span><span class="mi">1495</span>                 <span class="k">return</span> <span class="n">imread</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1496</span>     <span class="k">with</span> <span class="n">img_open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">image</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1497</span>         <span class="k">return</span> <span class="p">(</span><span class="n">_pil_png_to_float_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1498</span>                 <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">PIL</span><span class="o">.</span><span class="n">PngImagePlugin</span><span class="o">.</span><span class="n">PngImageFile</span><span class="p">)</span> <span class="k">else</span>

<span class="nn">/usr/lib/python3/dist-packages/PIL/ImageFile.py</span> in <span class="ni">__init__</span><span class="nt">(self, fp, filename)</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>         <span class="k">if</span> <span class="n">isPath</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span>             <span class="c1"># filename</span>
<span class="ne">---&gt; </span><span class="mi">95</span>             <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span>             <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fp</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_exclusive_fp</span> <span class="o">=</span> <span class="bp">True</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;map_MOSAiC-ACA_20200907.png&#39;
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="liquid-water-path-retrieval-from-brightness-temperature-observations">
<h1>Liquid water path retrieval from brightness temperature observations<a class="headerlink" href="#liquid-water-path-retrieval-from-brightness-temperature-observations" title="Permalink to this headline">¶</a></h1>
<p>In general, liquid water clouds increase the brightness temperature (<span class="math notranslate nohighlight">\(T_b\)</span>) observed by microwave instruments by emission. This increase in <span class="math notranslate nohighlight">\(T_b\)</span> makes them visible in front of the colder background, like the ocean surface with the much lower emissivity and enables us to derive the liquid water path (<span class="math notranslate nohighlight">\(LWP\)</span>) from observations. The methods to perform such a derivations are called retrieval algorithms.</p>
<p>Very simple but handy algorithms are linear or multiple regressions. Thereby, coefficients for fitting curves are derived based on a sufficiently large amount of pairs of observed <span class="math notranslate nohighlight">\(T_bs\)</span> and <span class="math notranslate nohighlight">\(LWP\)</span>s. Such pairs can be generated from atmospheric model runs in combination with radiative transfer models. Here we use the ICOsahedral Non-hydrostatic (ICON) model together with the Passive and Active Microwave TRAnsfer model (<span class="xref myst">PAMTRA; Mech et al., 2020</span>) to generate a database of <span class="math notranslate nohighlight">\(T_b\)</span>s and <span class="math notranslate nohighlight">\(LWP\)</span>s. In the algortihm used here, the difference between cloudy and nearby clear sky <span class="math notranslate nohighlight">\(T_b\)</span> is used as input for the retrieval. Since observations are difficult over sea ice or the marginal sea ice zone (MIZ) due to their unknown surface emissivity (the one over ocean can be calculated), only sea ice free observations and simulations are used.</p>
<p>In this example we use a cubic regression for the derivation of the liquid water path.</p>
<p><span class="math notranslate nohighlight">\(LWP = c_1 (\Delta T_b) + c_2 (\Delta T_b)^2 + c_3 (\Delta T_b)^3 ~~~~ \mathrm{with} ~~~~ \Delta T_b = T_b - T_0\)</span></p>
<p>The following steps describe how the coefficients are generated.</p>
<div class="section" id="collcection-of-methods-for-the-project-work">
<h2>Collcection of methods for the project work<a class="headerlink" href="#collcection-of-methods-for-the-project-work" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="k">import</span> <span class="n">KDTree</span>

<span class="k">class</span> <span class="nc">field_kdtree</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    KDtree are described on for example on https://towardsdatascience.com/using-scikit-learns-binary-trees-to-efficiently-find-latitude-and-longitude-neighbors-909979bd929b</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_lat</span><span class="p">,</span><span class="n">field_lon</span><span class="p">,</span><span class="n">isRad</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">kdtree</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="n">isRad</span><span class="p">:</span>
            <span class="n">field_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">field_lat</span><span class="p">)</span>
            <span class="n">field_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">field_lon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kdtree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">field_lat</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">field_lon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path_ds</span><span class="p">):</span>

        <span class="n">distance</span><span class="p">,</span> <span class="n">indices1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kdtree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span>
                    <span class="n">path_ds</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">path_ds</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span>
                <span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">indices1d</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdal</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">FILEPATH</span><span class="p">):</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">FILEPATH</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>
    
<span class="c1"># Opens the data HDF file and returns as a dataframe</span>
<span class="k">def</span> <span class="nf">read_dataset</span><span class="p">(</span><span class="n">SUBDATASET_NAME</span><span class="p">,</span> <span class="n">FILEPATH</span><span class="p">):</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">FILEPATH</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">sub</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetSubDatasets</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">description</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">SUBDATASET_NAME</span><span class="p">)):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">sub</span>
            <span class="k">break</span>
    <span class="k">if</span><span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">SUBDATASET_NAME</span> <span class="o">+</span> <span class="s1">&#39; not found&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">subdataset</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">subdataset</span> <span class="o">=</span> <span class="n">subdataset</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
    <span class="n">subdataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">subdataset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subdataset</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="open-pamtra-simulations">
<h2>Open PAMTRA simulations<a class="headerlink" href="#open-pamtra-simulations" title="Permalink to this headline">¶</a></h2>
<p>PAMTRA simulations for 89 GHz based on ICON atmospheric model simulations for the 07.09.2020. Only profiles over ocean have been included. lat/lon and the water paths for cloud, ice, rain, snow, graupel, and hail are directly the integrated values from the ICON model relevant for the retrieval.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_pam</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;data/pamtra_icon_passive.nc&#39;</span><span class="p">)</span> <span class="c1"># open data set with PAMTRA simulations</span>
</pre></div>
</div>
</div>
</div>
<p>The MiRAC radar is mounted with 25° backwards. This is to reduce the strong surface reflectivity which would lead to saturation in the receiver. In the simulations we have to consider the same angle.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tb</span> <span class="o">=</span> <span class="n">ds_pam</span><span class="p">[</span><span class="s1">&#39;tb&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># dims(nx,ny,nf,nang,nobs,npol) get the horizontal (npol=1) polarization at ~25° (nang=4), cause MiRAC-A 89 GHz is horizontally polarized</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">twp</span> <span class="o">=</span> <span class="n">ds_pam</span><span class="p">[</span><span class="s1">&#39;cwp&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">ds_pam</span><span class="p">[</span><span class="s1">&#39;iwp&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">ds_pam</span><span class="p">[</span><span class="s1">&#39;rwp&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">ds_pam</span><span class="p">[</span><span class="s1">&#39;swp&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">ds_pam</span><span class="p">[</span><span class="s1">&#39;gwp&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">ds_pam</span><span class="p">[</span><span class="s1">&#39;hwp&#39;</span><span class="p">]</span> <span class="c1"># this is the total integrated hydrometeor content from the ICON simulation</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">tb</span><span class="p">[</span><span class="n">twp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.00001</span><span class="p">],</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span> <span class="c1"># brightness temperature where total water path (twp) content is very small</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tb_clear</span> <span class="o">=</span> <span class="n">tb</span><span class="p">[</span><span class="n">twp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.00001</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1">#  find the mean clear sky brightness temperature</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tb_diff</span> <span class="o">=</span> <span class="n">tb</span> <span class="o">-</span> <span class="n">tb_clear</span> <span class="c1"># this is the field of brightness temperature differences that enters the retrieval development</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="develop-retrieval-coefficients-for-liquid-water-path">
<h2>Develop retrieval coefficients for liquid water path<a class="headerlink" href="#develop-retrieval-coefficients-for-liquid-water-path" title="Permalink to this headline">¶</a></h2>
<p>The process of finding the coefficients of a regression or a neural network is called developping. Here use the <em>curve_fit</em> method from <em>scipy.optimize</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">curve_fit</span>
</pre></div>
</div>
</div>
</div>
<p>Define a function that does the regression. Here we use a cubic function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cubic_regression</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">):</span><span class="k">return</span> <span class="n">c1</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">c2</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">c3</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<p>Get parameters for the cubic regression that will be applied to the brightness temperature differences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">c3</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">cubic_regression</span><span class="p">,</span> <span class="n">tb_diff</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">ds_pam</span><span class="p">[</span><span class="s1">&#39;cwp&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Apply coefficients to simulated brightness temperatures as self test</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lwp</span> <span class="o">=</span> <span class="n">c1</span><span class="o">*</span><span class="n">tb_diff</span><span class="o">+</span><span class="n">c2</span><span class="o">*</span><span class="n">tb_diff</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">c3</span><span class="o">*</span><span class="n">tb_diff</span><span class="o">**</span><span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scatter</span><span class="p">(</span><span class="n">lwp</span><span class="p">,</span><span class="n">ds_pam</span><span class="p">[</span><span class="s1">&#39;cwp&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">twp</span><span class="p">)</span>
<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;LWP retrieved [$\mathrm{kg/{m^2}}$]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;LWP simulated [$\mathrm{kg/{m^2}}$]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="read-in-airborne-data">
<h2>Read in  airborne data<a class="headerlink" href="#read-in-airborne-data" title="Permalink to this headline">¶</a></h2>
<p>For the comparison of liquid water path between airborne observations, model and reanalysis output, and satellite measurements we concentrate on observations over ocean from the 07.09.2020, RF07 of the <span class="xref myst">MOSAiC-ACA campaign</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ac3airborne</span> <span class="c1"># load the ac3 airborne module</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="n">ac3airborne</span><span class="o">.</span><span class="n">get_intake_catalog</span><span class="p">()</span> <span class="c1"># get the intake catalogue for the data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flight_id</span> <span class="o">=</span> <span class="s1">&#39;MOSAiC-ACA_P5_RF07&#39;</span> <span class="c1"># define flight</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seaice</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">Polar5</span><span class="o">.</span><span class="n">AMSR2_SIC</span><span class="p">[</span><span class="n">flight_id</span><span class="p">]</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span> <span class="c1">#  get sea ice data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">consecutive_valid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function selects all sections longer than N consecutive data points that are not equal nan.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#if (N % 2) != 0: N=2*(N//2)+1 # check for add N</span>
    <span class="c1">#return data.loc[np.isfinite(data.rolling(time=N, min_periods=N, center=True).sum().rolling(time=N, min_periods=1, center=True).sum())]</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">open_ocean</span> <span class="o">=</span> <span class="n">seaice</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">seaice</span><span class="o">.</span><span class="n">sic</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">long_ocean_sections</span> <span class="o">=</span> <span class="n">consecutive_valid</span><span class="p">(</span><span class="n">open_ocean</span><span class="p">[</span><span class="s1">&#39;sic&#39;</span><span class="p">],</span><span class="mi">60</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">Polar5</span><span class="o">.</span><span class="n">GPS_INS</span><span class="p">[</span><span class="n">flight_id</span><span class="p">]</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span> <span class="c1"># get position and attitude of platform</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_ocean</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">long_ocean_sections</span><span class="o">.</span><span class="n">time</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cut-out-corners">
<h3>Cut out corners<a class="headerlink" href="#cut-out-corners" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meta</span> <span class="o">=</span> <span class="n">ac3airborne</span><span class="o">.</span><span class="n">get_flight_segments</span><span class="p">()</span> <span class="c1"># Get flight segments</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">time_rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">periods</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">)</span> <span class="c1"># define empty pandas time range</span>
</pre></div>
</div>
</div>
</div>
<p>Get all high level segments of research flight <em>MOSAiC-ACA_P5_RF07</em>  and stick them together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;P5&#39;</span><span class="p">][</span><span class="n">flight_id</span><span class="p">][</span><span class="s1">&#39;segments&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="s1">&#39;high_level&#39;</span> <span class="ow">in</span> <span class="n">seg</span><span class="p">[</span><span class="s1">&#39;kinds&#39;</span><span class="p">]:</span>
        <span class="n">time_rng</span> <span class="o">=</span> <span class="n">time_rng</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span><span class="n">seg</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_ocean_straight_legs</span> <span class="o">=</span> <span class="n">track_ocean</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">isin</span><span class="p">(</span><span class="n">track_ocean</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">time_rng</span><span class="p">))]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">data_crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
<span class="n">map_crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">map_crs</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">data_crs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">track</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">data_crs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">track_ocean</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">track_ocean</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">data_crs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">track_ocean_straight_legs</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">track_ocean_straight_legs</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Clean up dataset before storing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_ocean_straight_legs</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_ocean_straight_legs</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s1">&#39;tas&#39;</span><span class="p">,</span><span class="s1">&#39;vs&#39;</span><span class="p">,</span><span class="s1">&#39;gs&#39;</span><span class="p">,</span><span class="s1">&#39;pitch&#39;</span><span class="p">,</span><span class="s1">&#39;roll&#39;</span><span class="p">,</span><span class="s1">&#39;alt&#39;</span><span class="p">,</span><span class="s1">&#39;heading&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;polar5_ocean_track_straight_legs.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em>polar5_ocean_track_straight_legs.nc</em> contains all times, latitudes, and longitudes that belong to observations along a straight line over open ocean.</p>
</div>
<div class="section" id="get-airborne-brightness-temperature-measurements">
<h3>Get airborne brightness temperature measurements<a class="headerlink" href="#get-airborne-brightness-temperature-measurements" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="datasets-and-todos">
<h2>Datasets and ToDos<a class="headerlink" href="#datasets-and-todos" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>MiRAC airborne observations: <em>mirac_tbs.nc</em></p></li>
<li><p>PAMTRA simulations including ICON field: <em>pamtra_icon_passive.nc</em></p></li>
<li><p>ERA5 liquied water path field: <em>era5-gl_20200907_lwp.nc</em></p></li>
<li><p>MODIS observations and geolocation: <em>MOD06_L2.A2020251.1055.061.2020251195046.hdf</em>, <em>MOD03.A2020251.1055.061.2020251164154.hdf</em></p></li>
<li><p>AMSR2 dataset: <em>GW1AM2_202009070848_026A_L2SGCLWLD2210210.h5</em></p></li>
</ul>
<p>Except for MODIS, all datasets are readable as xarrays. For MODIS, the routines are provided.</p>
<p>The python class <em>field_kdtree</em> can be used to cut a path from a model field. In the initialization the field is passed and the query methods results in the indices of the field that are next to the path positions.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./examples"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Mario Mech<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>